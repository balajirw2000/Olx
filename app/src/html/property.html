<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enlist Property</title>

    <!-- 
    - favicon
  -->
    <link rel="shortcut icon" href="../../favicon.svg" type="image/svg+xml" />

    <!-- 
  - custom css link
-->
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/registerStyle.css" />

    <!-- 
  - google font link
-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="../main.js"></script>

    <script>
      const ReadText = require("text-from-image");
    </script>
    <script>
      function validateBill(event) {
        console.log("billi");

        var selectedImg = event.target.files
          ? event.target.files[0]
          : $("#bill_file")[0].files[0];

        ReadText("./bill.jpeg")
          .then((text) => {
            console.log(text);
            var splitLines = text.split("\n");
            console.log(splitLines[7]);
            console.log(splitLines[11]);
            console.log(splitLines[12]);
          })
          .catch((err) => {
            console.log(err);
          });
      }
    </script>
  </head>
  <body>
    <header class="header" data-header>
      <div class="overlay" data-overlay></div>

    

      <div class="header-bottom">
        <div class="container">
          <a href="#" class="logo">
            <img
              class="landscape"
              src="./images/logo1.png"
              alt="Homeverse logo"
              style="object-fit: cover; height: 56px; width: 245px"
            />
          </a>

          <nav class="navbar" data-navbar>
            <div class="navbar-top">
              <a href="#" class="logo">
                <img src="./images/logo.png" alt="Homeverse logo" />
              </a>

              <button
                class="nav-close-btn"
                data-nav-close-btn
                aria-label="Close Menu"
              >
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>

            <div class="navbar-bottom">
              <ul class="navbar-list">
                <li>
                  <a href="index.html" class="navbar-link" data-nav-link
                    >Home</a
                  >
                </li>

                <li>
                  <a href="#about" class="navbar-link" data-nav-link>About</a>
                </li>

                <li>
                  <a
                    class="navbar-link"
                    data-nav-link
                    onclick="App.propertyDetails(1)"
                    >Service</a
                  >
                </li>

                <li>
                  <a href="#property" class="navbar-link" data-nav-link
                    >Products</a
                  >
                </li>

                <li>
                  <a href="#contact" class="navbar-link" data-nav-link
                    >Contact</a
                  >
                </li>

                <li>
                  <a
                    href="index.html"
                    class="navbar-link logout-btn"
                    data-nav-link
                    >Logout</a
                  >
                </li>
                
              </ul>
            </div>
          </nav>

          <div class="header-bottom-actions">
            <button class="enableEthereumButton btn btn-connect">
              Connect
            </button>
            <div class="dropdown">
              <span
                class="showAccount btn btn-connect"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
              </span>
              <!-- <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item logout-btn" href="index.html">Log Out</a></li> -->
              <!-- <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li> -->
              <!-- </ul> -->
            </div>

            <button
              class="header-bottom-actions-btn"
              data-nav-open-btn
              aria-label="Open Menu"
            >
              <ion-icon name="menu-outline"></ion-icon>

              <span>Menu</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="regContainer">
        <div class="main-box">
          <div class="row center-box">
            <h3>Enlist Product</h3>
            <div class="col-md-4 form-bg">
              <p>
                Meta Address:
                <input type="text" id="MetaAdd" placeholder="Meta Address" />
              </p>
              <p>City: <input type="text" id="City" placeholder="City" /></p>
              <p>State: <input type="text" id="State" placeholder="State" /></p>
              
              <p>
                Listing Price:
                <input
                  type="text"
                  id="ListingPrice"
                  placeholder="Listing Price"
                />
              </p>
              <p>
                Upload Product Image:
                <form id="file-form">
                  <input type="file" id="file-input"  />
                  <button type="submit">Upload</button>
                </form>
              </p>
              
              <div id="property">
                <button
                  type="submit"
                  class="btn btn-primary register"
                  style="font-size: 1.3rem"
                  onclick="App.enlist()"
                >
                  Enlist
                </button>
              </div>
            </div>
            <!-- end of col -->
          </div>
        </div>
        <!-- end of row -->
      </div>
      <!-- end of container -->
      
    </main>

    <script>
      console.log("Hii");
      const ethereumButton = document.querySelector(".enableEthereumButton");
      // const sendEthButton = document.querySelector('.sendEthButton');
      const showAccount = document.querySelector(".showAccount");
      const dropdown = document.querySelector(".dropdown");
      let accounts2 = [];
      var account;
      window.userWalletAddress = null;
      //Sending Ethereum to an address

      window.addEventListener("load", function () {
        if (!window.localStorage.getItem("userWalletAddress")) {
          console.log("Does not exist");
          console.log(dropdown);
          dropdown.style.display = "none";
        } else {
          account = window.localStorage.getItem("userWalletAddress");
          console.log(window.localStorage.getItem("userWalletAddress"));
          console.log("exist");
          ethereumButton.style.display = "none";

          var arrr = account.substr(2, 5) + "..." + account.slice(-4);
          console.log(arrr);
          showAccount.innerHTML = arrr;
          const MetaAdd = document.querySelector("#MetaAdd");
          MetaAdd.value = account;
        }
      });

      ethereumButton.addEventListener("click", () => {
        getAccount();
      });
      ethereum.on("accountsChanged", function (accounts2) {
        // Time to reload your interface with accounts2[0]!
      });
      async function getAccount() {
        accounts2 = await ethereum.request({ method: "eth_requestAccounts" });
        if (accounts2) {
          account = accounts2[0];
          showAccount.innerHTML = account;
          window.userWalletAddress = account;
          window.localStorage.setItem("userWalletAddress", account);
          window.location.href = "property.html";
          showUserDashboard();
        } else {
          alert("wallet not found");
        }
      }

      const showUserDashboard = async () => {
        // if the user is not logged in - userWalletAddress is null
        if (!window.userWalletAddress) {
          // return from the function
          // return false;
        } else {
          console.log(window.userWalletAddress);
          console.log("You are Loggewd in !!");
          const balance = await window.Web3.eth.getBalance(
            window.userWalletAddress
          );

          // convert the balance to ether
          console.log(web3.utils.fromWei(balance, "ether"));
        }
      };

      const logout = () => {
        window.userWalletAddress = null;
        window.localStorage.removeItem("userWalletAddress");
      };
      document.querySelector(".logout-btn").addEventListener("click", logout);
    </script>

    <script>
    const form = document.getElementById("file-form");
    const input = document.getElementById("file-input");
    const API_KEY = "68e6f7980028814c4563";
    const SECRET_API_KEY =
      "ff3f62aa544c5589aad5d9788ba59648e77ea02dc80c8f4447a95adf74aaee0d";

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const files = input.files;
      console.log("files", files)

      const imgArr = [];

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        console.log("fileeee", file)
        const formData = new FormData();
        formData.append("file", file);

        const options = {
          method: "POST",
          headers: {
            pinata_api_key: API_KEY,
            pinata_secret_api_key: SECRET_API_KEY,
          },
          body: formData,
        };

        const response = await fetch(
          "https://api.pinata.cloud/pinning/pinFileToIPFS",
          options
        );
        const json = await response.json();
        console.log(json);

        imgArr.push(json["IpfsHash"]);
      }

      console.log("imgArr ", imgArr);
      App.setPropertyImages(2, imgArr);
    });

    // window.onload(App.getPropertyImages(1));
    </script>
  </body>
</html>
